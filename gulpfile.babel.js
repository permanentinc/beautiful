const fs=require("fs"),gulp=require("gulp"),chalk=require("chalk"),watchify=require("watchify"),babelify=require("babelify"),sass=require("gulp-sass"),gutil=require("gulp-util"),browserify=require("browserify"),pixrem=require("gulp-pixrem"),plumber=require("gulp-plumber"),replace=require("gulp-replace"),sourcemaps=require("gulp-sourcemaps"),scsslint=require("gulp-scss-lint"),spritesmith=require("gulp.spritesmith"),autoprefixer=require("gulp-autoprefixer"),realFavicon=require("gulp-real-favicon"),source=require("vinyl-source-stream"),bulkSass=require("gulp-sass-bulk-import"),root=`${__dirname}/`,paths={styles:{src:`${root}app/styles/**/*.scss`,dest:`${root}dist/styles/`},scripts:{src:`${root}app/js/**/*.js`,dest:`${root}dist/js/`},sprites:{standard:`${root}app/sprites/*@1x.png`,retina:`${root}app/sprites/*@2x.png`},reg:{root:new RegExp(root+"app/","g"),dist:new RegExp(root+"dist/","g")}};gulp.task("scss-lint",function(){return gulp.src([paths.styles.src,`!${root}app/styles/Sprites`,`!${root}app/styles/Elements/_OffCanvas.scss`,`!${root}app/styles/Sprites/**`]).pipe(scsslint({maxBuffer:1e6,config:"scss_lint.yml"}))}),gulp.task("styles",()=>gulp.src(paths.styles.src).pipe(plumber(function(e){gutil.log(`${chalk.yellow(e.file.toString().replace(paths.reg.root,""))}`),gutil.log(`${chalk.red(e.messageOriginal)}`),this.emit("end")})).pipe(bulkSass()).pipe(sourcemaps.init()).pipe(sass({outputStyle:"compressed"})).pipe(autoprefixer({browsers:["last 15 versions"]})).pipe(pixrem({rootValue:"10px"})).pipe(sourcemaps.write("./")).pipe(gulp.dest(paths.styles.dest)));const rename=require("gulp-rename");function compileScripts(e){let s=watchify.args;s.entries=[`${root}/app/js/components/app.js`],s.debug=!0;let t=e?watchify(browserify(s)):browserify(s);function r(){return t.bundle().on("error",function(e){gutil.log(`${chalk.yellow(e.toString().replace(paths.reg.root,""))}`),gutil.log(e.codeFrame),this.emit("end")}).pipe(source("app.js")).pipe(gulp.dest(paths.scripts.dest))}return t.transform(babelify,{presets:["es2015"]}),t.on("update",function(){r()}),r()}function Message(e,s){let t=void 0!==s?s:"yellow";gutil.log(chalk[t](Messages[e]))}gulp.task("critical",()=>gulp.src(`${root}app/styles/critical.scss`).pipe(plumber(function(e){gutil.log(`${chalk.yellow(e.file.toString().replace(paths.reg.root,""))}`),gutil.log(`${chalk.red(e.messageOriginal)}`),this.emit("end")})).pipe(sass({outputStyle:"compressed"})).pipe(autoprefixer({browsers:["last 5 versions"]})).pipe(pixrem({rootValue:"10px"})).pipe(rename("critical.ss")).pipe(gulp.dest(`${root}templates/Includes/`))),gulp.task("sprites",()=>{let e=gulp.src(paths.sprites.standard).pipe(spritesmith({padding:4,imgName:"sprites.png",cssName:"_01-Sprites.scss",cssTemplate:`${root}app/sprites/sprite_positions.styl.mustache`}));e.img.pipe(gulp.dest(`${root}dist/images`)),e.css.pipe(replace("@1x","")).pipe(gulp.dest(`${root}app/styles/Sprites`));let s=gulp.src(paths.sprites.retina).pipe(spritesmith({padding:8,imgName:"sprites-retina.png",cssName:"_02-Sprites-retina.scss",cssTemplate:`${root}app/sprites/retina-sprite_positions.styl.mustache`}));s.img.pipe(gulp.dest(`${root}dist/images`)),s.css.pipe(replace("@2x","")).pipe(gulp.dest(`${root}app/styles/Sprites`))}),gulp.task("start",function(){Message("start","green")}),gulp.task("default",["scss-lint","start","sprites","styles"],function(){compileScripts(!0),gulp.watch([paths.styles.src],["styles"]).on("change",function(e){Message("scss","green"),gutil.log(chalk.green(" => ")+chalk.blue(e.path.replace(/^.*\/(?=[^\/]*$)/,""))+" was "+chalk.green(e.type))}),gulp.watch([`${root}/app/js/**/*.js`,`${root}/app/js/**/*.jsx`]).on("change",function(e){Message("js","green"),gutil.log(chalk.green(" => ")+chalk.blue(e.path.replace(/^.*\/(?=[^\/]*$)/,""))+" was "+chalk.green(e.type))})});const Messages={start:"\n██████╗ ███████╗ █████╗ ██╗   ██╗████████╗██╗███████╗██╗   ██╗██╗\n██╔══██╗██╔════╝██╔══██╗██║   ██║╚══██╔══╝██║██╔════╝██║   ██║██║\n██████╔╝█████╗  ███████║██║   ██║   ██║   ██║█████╗  ██║   ██║██║\n██╔══██╗██╔══╝  ██╔══██║██║   ██║   ██║   ██║██╔══╝  ██║   ██║██║\n██████╔╝███████╗██║  ██║╚██████╔╝   ██║   ██║██║     ╚██████╔╝███████╗\n╚═════╝ ╚══════╝╚═╝  ╚═╝ ╚═════╝    ╚═╝   ╚═╝╚═╝      ╚═════╝ ╚══════╝",scss:"╔═══════════════════════════╗\n           ║       Sass compiled       ║\n           ╚═══════════════════════════╝",js:"╔════════════════════════╗\n           ║       JS bundled       ║\n           ╚════════════════════════╝",error:"╔═══════════════════════╗\n           ║ An error has occurred ║\n           ╚═══════════════════════╝"};